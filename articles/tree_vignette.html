<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lionmap">
<title>Trees! Create Custom Hierarchies to Enhance Classification • lionmap</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Trees! Create Custom Hierarchies to Enhance Classification">
<meta property="og:description" content="lionmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lionmap</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Basic-Tutorial.html">Intro Tutorial</a>
    <a class="dropdown-item" href="../articles/seurat_obj_vignette.html">Importing Data from SeuratData and Getting It Into the Proper Format</a>
    <a class="dropdown-item" href="../articles/tree_vignette.html">Trees! Create Custom Hierarchies to Enhance Classification</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jonathan-columbiau/lionmap/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Trees! Create Custom Hierarchies to Enhance Classification</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jonathan-columbiau/lionmap/blob/HEAD/vignettes/tree_vignette.Rmd" class="external-link"><code>vignettes/tree_vignette.Rmd</code></a></small>
      <div class="d-none name"><code>tree_vignette.Rmd</code></div>
    </div>

    
    
<p><strong>What is a Hierarchy (aka Tree)?</strong></p>
<p>Note: The terms “phylogeny”, “tree”, and “hierarchy” are used
interchangeably here.</p>
<p>A hierarchy, also known as a tree, is a type of graph that
illustrates the relationships among a set of entities (represented as
nodes in a tree). Each node (with the exception of the rootnode)
descends from a parent node, and nodes that descend from the same parent
are more related to each other than are entities that descend from
different parent nodes.</p>
<p><strong>Why use a hierarchy?</strong></p>
<p>This article discusses the use of tree-based functionality in
creating and applying classification models. The main idea behind using
a hierarchy is to incorporate prior knowledge about the relationships
between cell types, typically provided in phylogenetic analyses of cell
types in large-scale reference atlases, to enhance classification speed
and accuracy.</p>
<p><strong>What are the advantages of using a hierarchy?</strong></p>
<p>Hierarchies can be used with both pairwise and non-pairwise
classification methods. However, since this package employs pairwise
methods, the focus here is on benefits in a pairwise context, although
some advantages are applicable to both.</p>
<p><strong>Advantage Number 1: Reduced Computational Resources and
Time</strong></p>
<p>One of the primary benefits of using a hierarchy is reducing the
amount of computations you need to perform to get a classification. This
becomes particularly crucial when your reference atlas has many cell
types (ex: dozens or hundreds). In a pairwise context, using a hierarchy
significantly reduces computational time by reducing the number of
cell-cell comparisons that need to be performed to get a classification.
This is because the number of pairwise comparisons you’ll need to
perform at any given level of a hierarchy is proportional to the square
of the number of celltypes at that level.</p>
<p>Number of comparisons = n(n-1) / 2</p>
<p>As an example, let’s take a cell and say it can be classified into
one of twenty possible celltypes. Let’s say we don’t use a hierarchy,
and consider each element as equally likely to occur. To get a
classification we’ll need to perform 20*(20 - 1) / 2 = 190
comparisons.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.amazon.com/Integration-Manipulation-Visualization-Phylogenetic-Computational-ebook/dp/B0B5NLZR1Z/" class="external-link">ggtree</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonathan-columbiau/lionmap" class="external-link">lionmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="va">equal_tree</span> <span class="op">=</span> <span class="fu">lionmap</span><span class="fu">::</span><span class="fu"><a href="../reference/CreateEqualTree.html">CreateEqualTree</a></span><span class="op">(</span>cell_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="st">"n"</span><span class="op">)</span>,rootnode_name <span class="op">=</span> <span class="st">"Root"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html" class="external-link">ggtree</a></span><span class="op">(</span><span class="va">equal_tree</span><span class="op">)</span> <span class="op">+</span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html" class="external-link">geom_nodelab</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, node <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> </span></code></pre></div>
<p>Alternatively, let’ say we can group the 20 nodes into 4 groups each
with 5 nodes, and these groups can be grouped into two groups each with
2 nodes, and these 2 nodes group together.</p>
<p>You can manually create a tree that looks like this with the
following code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_df</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>            parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>,<span class="st">"p1"</span>,<span class="st">"p1"</span>,<span class="st">"p1"</span>,<span class="st">"p1"</span>,</span>
<span>                       <span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,</span>
<span>                       <span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"gp1"</span>,<span class="st">"gp1"</span>,<span class="st">"gp2"</span>,</span>
<span>                       <span class="st">"gp2"</span>,<span class="st">"rootnode"</span>,<span class="st">"rootnode"</span>,<span class="st">"rootnode"</span><span class="op">)</span>,</span>
<span>              node <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n1"</span>,<span class="st">"n2"</span>,<span class="st">"n3"</span>,<span class="st">"n4"</span>,<span class="st">"n5"</span>,</span>
<span>                       <span class="st">"n6"</span>,<span class="st">"n7"</span>,<span class="st">"n8"</span>,<span class="st">"n9"</span>,<span class="st">"n10"</span>,<span class="st">"n11"</span>,<span class="st">"n12"</span>,<span class="st">"n13"</span>,<span class="st">"n14"</span>,</span>
<span>                       <span class="st">"n15"</span>,<span class="st">"n16"</span>,<span class="st">"n17"</span>,<span class="st">"n18"</span>,<span class="st">"n19"</span>,<span class="st">"n20"</span>,<span class="st">"p1"</span>,<span class="st">"p2"</span>,</span>
<span>                       <span class="st">"p3"</span>,<span class="st">"p4"</span>,<span class="st">"gp1"</span>,<span class="st">"gp2"</span>,<span class="st">"rootnode"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/ggtree.html" class="external-link">ggtree</a></span><span class="op">(</span><span class="fu">treeio</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/as.phylo.html" class="external-link">as.phylo</a></span><span class="op">(</span><span class="va">tree_df</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/ggtree/man/geom_nodelab.html" class="external-link">geom_nodelab</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, node <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> </span></code></pre></div>
<p>Or, you can use the helper function CreateHierarchy, which takes in a
csv file with the columns “parent” and “node”, and provides gives the
relationships between each node with its parent node in the tree. The
function will return a TreeData object, which you can use with the
functions in Lionmap.</p>
<p>The total number of comparisons we need to get a classification now
are: 2 at the top level (rootnode -&gt; gp level), 2 for the second
level (gp -&gt; p level), and 5(5-1)/2 = 10 at the final level (p -&gt;
n level) for a grand total of 2 + 2 + 10 = 14 comparisons! A big
difference, huh.</p>
<p><strong>Advantage Number 2: Ability to assess confidence at
progressively more comprehensive classification levels.</strong></p>
<p>We attempt to assess whether we have high or low mapping in a given
classification.</p>
<p><strong>Advantage Number 3: Increase Interpretability and Lower
Potential Mistakes</strong></p>
<p>Using a hierarchy allows you to select features highly relevant to
the current pairwise comparison of interest. At best, irrelevant
information won’t contribute anything; at worst, it can interfere with
proper model training and lead to classification mistakes.</p>
<p>In Lionmap, for each pairwise comparison at each level of the
hierarchy, we find marker genes that distinguish each class and only use
those in downstream analyses. This means that only present marker genes
contribute to the classification, so you have a targeted group of genes
you can look into further if you want to investigate how the classifiers
are distinguishing the two classes of interest.</p>
<p><strong>Great, now how do you build a hierarchy?</strong></p>
<p>The package provides a helper function, CreateHierarchy, that takes
in either a CSV file or a dataframe, and returns a tree. The input must
contain two columns, one labeled “node” and one labeled “parent” and be
arranged in tidy format, which just means each row corresponds to one
node.</p>
<p>The first row denotes the column names, so column 1, row 1 should
have the value of “node” and column 1, row 2 should have the value of
“parent”. For each row/node, you have to say what the name of that node
is (in the node column), and what the name of the parent node is (in the
parent column). The names of the nodes at the most granular level should
correspond to the metadata classifications (ex: cluster names) that you
also input as a parameter in the FindMarkerGenes and GetModels
functions. At higher levels of classification, you should also have
names for internal nodes.</p>
<p>This helper function was made so that users can use Excel or another
text editor to quickly write out the parent and child relationships in
the tree and directly use it. In practice, I like to start building
trees from the bottom up, first starting at the most granular
classifications and then working my way toward the top.</p>
<p>For example, to create a hierarchical tree shown in the
<strong>Advantage Number 1</strong> section above, create a dataframe
with the following data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="va">tree_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>            parent <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"p1"</span>,<span class="st">"p1"</span>,<span class="st">"p1"</span>,<span class="st">"p1"</span>,<span class="st">"p1"</span>,</span>
<span>                       <span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p2"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,<span class="st">"p3"</span>,</span>
<span>                       <span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"p4"</span>,<span class="st">"gp1"</span>,<span class="st">"gp1"</span>,<span class="st">"gp2"</span>,</span>
<span>                       <span class="st">"gp2"</span>,<span class="st">"rootnode"</span>,<span class="st">"rootnode"</span>,<span class="st">"rootnode"</span><span class="op">)</span>,</span>
<span>              node <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n1"</span>,<span class="st">"n2"</span>,<span class="st">"n3"</span>,<span class="st">"n4"</span>,<span class="st">"n5"</span>,</span>
<span>                       <span class="st">"n6"</span>,<span class="st">"n7"</span>,<span class="st">"n8"</span>,<span class="st">"n9"</span>,<span class="st">"n10"</span>,<span class="st">"n11"</span>,<span class="st">"n12"</span>,<span class="st">"n13"</span>,<span class="st">"n14"</span>,</span>
<span>                       <span class="st">"n15"</span>,<span class="st">"n16"</span>,<span class="st">"n17"</span>,<span class="st">"n18"</span>,<span class="st">"n19"</span>,<span class="st">"n20"</span>,<span class="st">"p1"</span>,<span class="st">"p2"</span>,</span>
<span>                       <span class="st">"p3"</span>,<span class="st">"p4"</span>,<span class="st">"gp1"</span>,<span class="st">"gp2"</span>,<span class="st">"rootnode"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#Let's view it:</span></span>
<span><span class="fu">kbl</span><span class="op">(</span><span class="va">tree_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kable_styling</span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And now let’s use the helper function to create the TreeData object
that’s used as the input hierarchical file format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">treedata_obj</span> <span class="op">=</span> <span class="fu"><a href="../reference/CreateHierarchy.html">CreateHierarchy</a></span><span class="op">(</span>csv_file_path <span class="op">=</span> <span class="cn">NULL</span>, df_hierarchy <span class="op">=</span> <span class="va">tree_df</span><span class="op">)</span></span>
<span><span class="va">treedata_obj</span></span></code></pre></div>
<p>This package relies heavily on the phylogeny-based infrastructure
developed by the Yu lab. For more information, check out their book <a href="https://yulab-smu.top/treedata-book/index.html" class="external-link"><strong>Data
Integration, Manipulation and Visualization of Phylogenetic
Trees</strong></a>.</p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jonathan Algoo.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
